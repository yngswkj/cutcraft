# CutCraft 要件定義書

## 概要

CutCraft は、Sora 2 / Veo 3.1 Fast API を活用して約2分間の動画を制作するための個人用ワークフローツール。AI による設計図提案からシーン別動画生成までを一気通貫で管理する。

## 対象ユーザー

- 個人利用（外部公開なし）

## やること・やらないこと

### やること

1. テーマから動画の設計図を AI で提案
2. ユーザーによる設計図の微調整
3. 設計図からイメージボード（参考画像）の作成
4. イメージボードのシーン別調整
5. 設計図とイメージボードからシーンごとの台本（動画生成プロンプト）作成
6. 台本から動画生成
7. 生成した動画の一覧確認

### やらないこと

- 動画同士の結合やカット編集（別アプリを使用）
- 文字入れ（別アプリを使用）

---

## 機能要件

### F1. プロジェクト管理

| 項目 | 内容 |
|------|------|
| プロジェクト作成 | 名前とテーマを入力して新規作成 |
| プロジェクト一覧 | 更新日時の降順で表示 |
| プロジェクト削除 | 確認ダイアログ付き |
| ワークフロー管理 | 5段階ステップの進捗管理 |

**実装状況: 実装済み**

### F2. 設計図（Blueprint）

| 項目 | 内容 |
|------|------|
| AI 生成 | テーマから GPT-4o で設計図を自動生成 |
| 目標時間 | 合計約120秒 |
| シーン分割 | 8〜15シーン程度 |
| シーン編集 | タイトル、説明、秒数、スタイル方向性、API選択 |
| シーン操作 | 並び替え（上下移動）、削除、手動追加 |
| API 設定 | おまかせ（AI判断）/ Sora のみ / Veo のみ |
| コスト表示 | 推定コスト（動画 + 画像）のリアルタイム表示 |
| 再生成 | 既存設計図の上書き再生成 |

**実装状況: 実装済み**

### F3. イメージボード（Imageboard）

| 項目 | 内容 |
|------|------|
| 画像生成 | `gpt-image-1.5` / `gemini-3-pro-image-preview` で参考画像を生成 |
| プロンプト入力 | シーンごとにカスタムプロンプト |
| 複数画像管理 | 1シーンに複数画像を生成・管理可能 |
| 画像選択 | 選択した画像をシーンの代表画像に設定 |
| Image-to-Video | 選択画像を動画生成の入力として使用するオプション |
| 画像削除 | 不要な画像の削除 |
| 進行条件 | 全シーンに最低1枚の画像が必要 |

**実装状況: 実装済み**

### F4. 台本（Script）

| 項目 | 内容 |
|------|------|
| AI 自動生成 | GPT-4o で動画生成プロンプト（英語）を自動作成 |
| 一括生成 | 未作成の台本を一括で AI 生成 |
| プロンプト編集 | 動画生成プロンプトの手動編集 |
| メタデータ | カメラワーク、動き、ライティング、スタイルの日本語メタデータ |
| 参考画像表示 | 選択した参考画像の表示 |
| 進行条件 | 全シーンに台本が必要 |

**実装状況: 実装済み**

### F5. 動画生成（Generate）

| 項目 | 内容 |
|------|------|
| Sora 生成 | OpenAI Sora API で動画生成（4/8/12秒へ丸め） |
| Veo 生成 | Google Veo 3.1 Fast API で動画生成（4/6/8秒） |
| 一括生成 | 未生成シーンを一括で動画生成 |
| ステータス監視 | 5秒間隔のポーリングでステータス確認 |
| 自動ダウンロード | 完了時に動画を自動ダウンロードしてローカル保存 |
| 動画プレビュー | インラインでの動画再生 |
| バージョン管理 | 再生成による複数バージョンの履歴管理 |
| 動画承認 | 各シーンの動画を承認するワークフロー |
| 再生成 | 承認前・承認後どちらでも再生成可能 |
| 進行条件 | 全シーンの動画が承認済みであること |

**実装状況: 実装済み**

### F6. シーンチェーン

| 項目 | 内容 |
|------|------|
| チェーンオプション | 前のシーンの最終フレームを次のシーンの入力として使用 |
| フレーム抽出 | ffmpeg で動画の最終フレームを PNG として抽出 |
| 条件 | 前のシーンの動画が承認済みであること |
| 優先順位 | チェーンフレーム > useAsVideoInput 画像 > なし |

**実装状況: 実装済み**

### F7. 完了（Complete）

| 項目 | 内容 |
|------|------|
| サマリー | シーン数、合計秒数、推定コストの表示 |
| 動画一覧 | 承認済み動画の一覧表示 |
| 動画プレビュー | 全シーンの動画をインラインで再生 |

**実装状況: 実装済み**

---

## 未実装機能

### U1. 動画ファイルエクスポート

| 項目 | 内容 |
|------|------|
| 一括ダウンロード | 全シーンの承認済み動画をZIPでダウンロード |
| ファイル名規則 | シーン番号順の連番ファイル名 |
| 優先度 | 中 |

### U2. プロジェクト複製

| 項目 | 内容 |
|------|------|
| テンプレート化 | 既存プロジェクトの設計図をテンプレートとして再利用 |
| 優先度 | 低 |

### U3. ドラッグ＆ドロップによるシーン並び替え

| 項目 | 内容 |
|------|------|
| D&D | 上下ボタンではなくドラッグ操作でシーン並び替え |
| ライブラリ | @dnd-kit 等の導入 |
| 優先度 | 低 |

### U4. 画像アップロード

| 項目 | 内容 |
|------|------|
| ローカル画像入力 | AI画像生成（gpt-image / nano banana pro）ではなくユーザー手持ちの画像をアップロード |
| Image-to-Video | アップロード画像も動画生成の入力として利用可能 |
| 優先度 | 中 |

### U5. コスト実績管理

| 項目 | 内容 |
|------|------|
| 実績記録 | 実際に消費した API コスト（推定ではなく実績）を記録 |
| 累計表示 | プロジェクト単位・全体の累計コスト表示 |
| 優先度 | 低 |

### U6. Sora 解像度選択

| 項目 | 内容 |
|------|------|
| 解像度選択 | 1280x720 / 1792x1024 / 1024x1792 のユーザー選択 |
| コスト連動 | 選択解像度に応じたコスト計算 |
| 現状 | UI選択は未実装。入力画像の縦横・サイズから自動決定 |
| 優先度 | 中 |

### U7. プロンプト履歴管理

| 項目 | 内容 |
|------|------|
| 履歴保存 | 画像・台本の生成プロンプト履歴を保持 |
| 再利用 | 過去のプロンプトを選択して再利用 |
| 優先度 | 低 |

### U8. Veo image-to-video 入力

| 項目 | 内容 |
|------|------|
| 現状 | Veo の画像入力は config に設定しているが、Gemini API の仕様に完全準拠しているか未検証 |
| 優先度 | 中（Veo 利用時に検証が必要） |

### U9. エラーリカバリ

| 項目 | 内容 |
|------|------|
| リトライ | 失敗した動画生成のリトライ機能 |
| 途中再開 | アプリ再起動後の処理中ジョブの再開 |
| 現状 | ポーリング再開は実装済み。明示的リトライUIは未実装 |
| 優先度 | 中 |

### U10. 全シーン一括画像生成

| 項目 | 内容 |
|------|------|
| 一括生成 | イメージボードで全シーンの画像を一括生成 |
| 現状 | 台本と動画には一括生成があるが、画像にはない |
| 優先度 | 中 |

---

## 非機能要件

| 項目 | 内容 |
|------|------|
| データ保存 | ローカルファイルシステム（JSON + バイナリ） |
| 認証 | なし（個人利用） |
| 対応ブラウザ | モダンブラウザ（Chrome推奨） |
| UI 言語 | 日本語 |
| タイポグラフィ | Noto Sans JP、palt、適切な letter-spacing / line-height |
| レスポンシブ | 非対応（デスクトップ想定） |
| 外部依存 | ffmpeg（シーンチェーン機能に必要） |

---

## 環境変数

| 変数名 | 用途 |
|--------|------|
| `OPENAI_API_KEY` | OpenAI API（GPT-4o, GPT Image 1.5, Sora） |
| `GOOGLE_AI_API_KEY` | Google Gemini API（Veo 3.1 Fast） |
